<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Alice Family Expense</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
        }
        * {
            box-sizing: border-box;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-purple-50 to-pink-50">
    <div id="app"></div>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function AliceFamilyExpense() {
            const [expenses, setExpenses] = useState([]);
            const [amount, setAmount] = useState('');
            const [person, setPerson] = useState('');
            const [category, setCategory] = useState('');
            const [paymentMethod, setPaymentMethod] = useState('');
            const [date, setDate] = useState(new Date().toISOString().split('T')[0]);
            const [familyMembers, setFamilyMembers] = useState(['Child 1', 'Child 2', 'Husband']);
            const [paymentMethods, setPaymentMethods] = useState(['Cash', 'Credit Card 1', 'Credit Card 2', 'Wire Transfer', 'Debit Card']);
            const [newMember, setNewMember] = useState('');
            const [newPayment, setNewPayment] = useState('');
            const [filter, setFilter] = useState('all');
            const [showReports, setShowReports] = useState(false);
            const [reportType, setReportType] = useState('person');
            const [dateFrom, setDateFrom] = useState('');
            const [dateTo, setDateTo] = useState('');

            useEffect(() => {
                loadData();
            }, []);

            useEffect(() => {
                saveData();
            }, [expenses, familyMembers, paymentMethods]);

            const loadData = () => {
                try {
                    const expensesData = localStorage.getItem('alice-family-expenses');
                    const membersData = localStorage.getItem('alice-family-members');
                    const paymentsData = localStorage.getItem('alice-payment-methods');
                    
                    if (expensesData) {
                        setExpenses(JSON.parse(expensesData));
                    }
                    if (membersData) {
                        setFamilyMembers(JSON.parse(membersData));
                    }
                    if (paymentsData) {
                        setPaymentMethods(JSON.parse(paymentsData));
                    }
                } catch (error) {
                    console.log('No saved data found');
                }
            };

            const saveData = () => {
                try {
                    localStorage.setItem('alice-family-expenses', JSON.stringify(expenses));
                    localStorage.setItem('alice-family-members', JSON.stringify(familyMembers));
                    localStorage.setItem('alice-payment-methods', JSON.stringify(paymentMethods));
                } catch (error) {
                    console.error('Error saving data:', error);
                }
            };

            const addExpense = () => {
                if (amount && person && category && paymentMethod) {
                    const newExpense = {
                        id: Date.now(),
                        amount: parseFloat(amount),
                        person,
                        category,
                        paymentMethod,
                        date
                    };
                    setExpenses([newExpense, ...expenses]);
                    setAmount('');
                    setCategory('');
                }
            };

            const deleteExpense = (id) => {
                setExpenses(expenses.filter(e => e.id !== id));
            };

            const addFamilyMember = () => {
                if (newMember && !familyMembers.includes(newMember)) {
                    setFamilyMembers([...familyMembers, newMember]);
                    setNewMember('');
                }
            };

            const removeFamilyMember = (member) => {
                setFamilyMembers(familyMembers.filter(m => m !== member));
            };

            const addPaymentMethod = () => {
                if (newPayment && !paymentMethods.includes(newPayment)) {
                    setPaymentMethods([...paymentMethods, newPayment]);
                    setNewPayment('');
                }
            };

            const removePaymentMethod = (method) => {
                setPaymentMethods(paymentMethods.filter(m => m !== method));
            };

            const filteredExpenses = filter === 'all' 
                ? expenses 
                : expenses.filter(e => e.person === filter);

            const getTotalByPerson = (person) => {
                return expenses
                    .filter(e => e.person === person)
                    .reduce((sum, e) => sum + e.amount, 0);
            };

            const totalExpenses = expenses.reduce((sum, e) => sum + e.amount, 0);

            const getReportData = () => {
                let filtered = expenses;
                
                if (dateFrom) {
                    filtered = filtered.filter(e => e.date >= dateFrom);
                }
                if (dateTo) {
                    filtered = filtered.filter(e => e.date <= dateTo);
                }

                const grouped = {};

                if (reportType === 'person') {
                    filtered.forEach(expense => {
                        if (!grouped[expense.person]) {
                            grouped[expense.person] = { total: 0, count: 0, expenses: [] };
                        }
                        grouped[expense.person].total += expense.amount;
                        grouped[expense.person].count += 1;
                        grouped[expense.person].expenses.push(expense);
                    });
                } else if (reportType === 'payment') {
                    filtered.forEach(expense => {
                        if (!grouped[expense.paymentMethod]) {
                            grouped[expense.paymentMethod] = { total: 0, count: 0, expenses: [] };
                        }
                        grouped[expense.paymentMethod].total += expense.amount;
                        grouped[expense.paymentMethod].count += 1;
                        grouped[expense.paymentMethod].expenses.push(expense);
                    });
                } else if (reportType === 'date') {
                    filtered.forEach(expense => {
                        if (!grouped[expense.date]) {
                            grouped[expense.date] = { total: 0, count: 0, expenses: [] };
                        }
                        grouped[expense.date].total += expense.amount;
                        grouped[expense.date].count += 1;
                        grouped[expense.date].expenses.push(expense);
                    });
                }

                return grouped;
            };

            const shareReport = () => {
                const reportData = getReportData();
                const reportTypeLabel = reportType === 'person' ? 'By Person' : reportType === 'payment' ? 'By Payment Method' : 'By Date';
                const dateRange = (dateFrom || dateTo) ? `(${dateFrom || 'start'} to ${dateTo || 'today'})` : '(All time)';
                
                let reportText = `ALICE FAMILY EXPENSE REPORT\n`;
                reportText += `Report Type: ${reportTypeLabel} ${dateRange}\n`;
                reportText += `Generated: ${new Date().toLocaleDateString()}\n`;
                reportText += `\n${'='.repeat(50)}\n\n`;

                const sortedData = Object.entries(reportData).sort(([, a], [, b]) => b.total - a.total);
                
                sortedData.forEach(([key, data]) => {
                    reportText += `${key.toUpperCase()}\n`;
                    reportText += `Total: ${data.total.toFixed(2)} (${data.count} transaction${data.count !== 1 ? 's' : ''})\n`;
                    reportText += `${'-'.repeat(50)}\n`;
                    
                    data.expenses.forEach(expense => {
                        reportText += `  ${expense.date} - ${expense.category} - ${expense.amount.toFixed(2)}\n`;
                        if (reportType !== 'person') reportText += `    Person: ${expense.person}\n`;
                        if (reportType !== 'payment') reportText += `    Payment: ${expense.paymentMethod}\n`;
                    });
                    reportText += `\n`;
                });

                const grandTotal = sortedData.reduce((sum, [, data]) => sum + data.total, 0);
                reportText += `${'='.repeat(50)}\n`;
                reportText += `GRAND TOTAL: ${grandTotal.toFixed(2)}\n`;

                // Copy to clipboard
                navigator.clipboard.writeText(reportText).then(() => {
                    alert('Report copied to clipboard! You can now paste it into WhatsApp, email, or any messaging app.');
                }).catch(() => {
                    // Fallback for older browsers
                    const textArea = document.createElement('textarea');
                    textArea.value = reportText;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    alert('Report copied to clipboard! You can now paste it into WhatsApp, email, or any messaging app.');
                });
            };

            return (
                <div className="p-4">
                    <div className="max-w-4xl mx-auto">
                        <div className="bg-white rounded-2xl shadow-xl p-6 mb-6">
                            <div className="flex items-center gap-3 mb-6">
                                <svg className="w-8 h-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                <h1 className="text-3xl font-bold text-gray-800">Alice Family Expense</h1>
                            </div>

                            {/* Add Expense Form */}
                            <div className="bg-purple-50 rounded-xl p-4 mb-6">
                                <h2 className="text-lg font-semibold mb-3 text-gray-700">Add New Expense</h2>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                                    <input
                                        type="number"
                                        placeholder="Amount"
                                        value={amount}
                                        onChange={(e) => setAmount(e.target.value)}
                                        className="px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                    />
                                    <select
                                        value={person}
                                        onChange={(e) => setPerson(e.target.value)}
                                        className="px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                    >
                                        <option value="">Select Person</option>
                                        {familyMembers.map(member => (
                                            <option key={member} value={member}>{member}</option>
                                        ))}
                                    </select>
                                    <input
                                        type="text"
                                        placeholder="Category (e.g., Food, Clothes)"
                                        value={category}
                                        onChange={(e) => setCategory(e.target.value)}
                                        className="px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                    />
                                    <select
                                        value={paymentMethod}
                                        onChange={(e) => setPaymentMethod(e.target.value)}
                                        className="px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                    >
                                        <option value="">Select Payment Method</option>
                                        {paymentMethods.map(method => (
                                            <option key={method} value={method}>{method}</option>
                                        ))}
                                    </select>
                                    <input
                                        type="date"
                                        value={date}
                                        onChange={(e) => setDate(e.target.value)}
                                        className="px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-500 focus:border-transparent md:col-span-2"
                                    />
                                </div>
                                <button
                                    onClick={addExpense}
                                    className="mt-3 w-full bg-purple-600 text-white py-2 rounded-lg hover:bg-purple-700 transition flex items-center justify-center gap-2"
                                >
                                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                                    </svg>
                                    Add Expense
                                </button>
                            </div>

                            {/* Manage Family Members */}
                            <div className="bg-pink-50 rounded-xl p-4 mb-6">
                                <h2 className="text-lg font-semibold mb-3 text-gray-700">Manage Family Members</h2>
                                <div className="flex gap-2 mb-3">
                                    <input
                                        type="text"
                                        placeholder="Add new member"
                                        value={newMember}
                                        onChange={(e) => setNewMember(e.target.value)}
                                        className="flex-1 px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                    />
                                    <button
                                        onClick={addFamilyMember}
                                        className="bg-pink-600 text-white px-4 py-2 rounded-lg hover:bg-pink-700 transition"
                                    >
                                        Add
                                    </button>
                                </div>
                                <div className="flex flex-wrap gap-2">
                                    {familyMembers.map(member => (
                                        <div key={member} className="bg-white px-3 py-1 rounded-full flex items-center gap-2 shadow-sm">
                                            <span className="text-sm">{member}</span>
                                            <button
                                                onClick={() => removeFamilyMember(member)}
                                                className="text-red-500 hover:text-red-700 font-bold"
                                            >
                                                ×
                                            </button>
                                        </div>
                                    ))}
                                </div>
                            </div>

                            {/* Manage Payment Methods */}
                            <div className="bg-blue-50 rounded-xl p-4 mb-6">
                                <h2 className="text-lg font-semibold mb-3 text-gray-700">Manage Payment Methods</h2>
                                <div className="flex gap-2 mb-3">
                                    <input
                                        type="text"
                                        placeholder="Add new payment method"
                                        value={newPayment}
                                        onChange={(e) => setNewPayment(e.target.value)}
                                        className="flex-1 px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    />
                                    <button
                                        onClick={addPaymentMethod}
                                        className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition"
                                    >
                                        Add
                                    </button>
                                </div>
                                <div className="flex flex-wrap gap-2">
                                    {paymentMethods.map(method => (
                                        <div key={method} className="bg-white px-3 py-1 rounded-full flex items-center gap-2 shadow-sm">
                                            <span className="text-sm">{method}</span>
                                            <button
                                                onClick={() => removePaymentMethod(method)}
                                                className="text-red-500 hover:text-red-700 font-bold"
                                            >
                                                ×
                                            </button>
                                        </div>
                                    ))}
                                </div>
                            </div>

                            {/* Summary */}
                            <div className="bg-gradient-to-r from-purple-100 to-pink-100 rounded-xl p-4 mb-6">
                                <div className="flex items-center gap-2 mb-3">
                                    <h2 className="text-lg font-semibold text-gray-700">Summary</h2>
                                </div>
                                <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <div className="bg-white rounded-lg p-3 text-center">
                                        <p className="text-sm text-gray-600">Total</p>
                                        <p className="text-xl font-bold text-purple-600">${totalExpenses.toFixed(2)}</p>
                                    </div>
                                    {familyMembers.map(member => (
                                        <div key={member} className="bg-white rounded-lg p-3 text-center">
                                            <p className="text-sm text-gray-600">{member}</p>
                                            <p className="text-xl font-bold text-pink-600">${getTotalByPerson(member).toFixed(2)}</p>
                                        </div>
                                    ))}
                                </div>
                            </div>

                            {/* Filter and Reports Button */}
                            <div className="mb-4 flex flex-wrap items-center gap-3">
                                <select
                                    value={filter}
                                    onChange={(e) => setFilter(e.target.value)}
                                    className="px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                >
                                    <option value="all">All Expenses</option>
                                    {familyMembers.map(member => (
                                        <option key={member} value={member}>{member}</option>
                                    ))}
                                </select>
                                <button
                                    onClick={() => setShowReports(!showReports)}
                                    className="bg-gradient-to-r from-purple-600 to-pink-600 text-white px-4 py-2 rounded-lg hover:from-purple-700 hover:to-pink-700 transition flex items-center gap-2"
                                >
                                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                                    </svg>
                                    {showReports ? 'Hide Reports' : 'View Reports'}
                                </button>
                            </div>

                            {/* Reports Section */}
                            {showReports && (
                                <div className="bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl p-4 mb-6">
                                    <div className="flex items-center justify-between mb-4">
                                        <h2 className="text-lg font-semibold text-gray-700">Detailed Reports</h2>
                                        <button
                                            onClick={shareReport}
                                            className="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition flex items-center gap-2 text-sm"
                                        >
                                            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />
                                            </svg>
                                            Share Report
                                        </button>
                                    </div>
                                    
                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-3 mb-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Report Type</label>
                                            <select
                                                value={reportType}
                                                onChange={(e) => setReportType(e.target.value)}
                                                className="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                            >
                                                <option value="person">By Person</option>
                                                <option value="payment">By Payment Method</option>
                                                <option value="date">By Date</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">From Date</label>
                                            <input
                                                type="date"
                                                value={dateFrom}
                                                onChange={(e) => setDateFrom(e.target.value)}
                                                className="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">To Date</label>
                                            <input
                                                type="date"
                                                value={dateTo}
                                                onChange={(e) => setDateTo(e.target.value)}
                                                className="w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                            />
                                        </div>
                                    </div>

                                    <div className="space-y-3">
                                        {Object.entries(getReportData())
                                            .sort(([, a], [, b]) => b.total - a.total)
                                            .map(([key, data]) => (
                                                <div key={key} className="bg-white rounded-lg p-4 shadow-sm">
                                                    <div className="flex items-center justify-between mb-2">
                                                        <h3 className="font-semibold text-gray-800">{key}</h3>
                                                        <div className="text-right">
                                                            <div className="text-2xl font-bold text-purple-600">${data.total.toFixed(2)}</div>
                                                            <div className="text-sm text-gray-500">{data.count} transaction{data.count !== 1 ? 's' : ''}</div>
                                                        </div>
                                                    </div>
                                                    <div className="mt-3 space-y-2">
                                                        {data.expenses.map(expense => (
                                                            <div key={expense.id} className="flex items-center justify-between text-sm bg-gray-50 p-2 rounded">
                                                                <div className="flex flex-wrap items-center gap-2">
                                                                    <span className="text-gray-600">{expense.date}</span>
                                                                    <span className="text-gray-400">•</span>
                                                                    <span className="text-gray-700">{expense.category}</span>
                                                                    {reportType !== 'person' && (
                                                                        <>
                                                                            <span className="text-gray-400">•</span>
                                                                            <span className="text-gray-600">{expense.person}</span>
                                                                        </>
                                                                    )}
                                                                    {reportType !== 'payment' && (
                                                                        <>
                                                                            <span className="text-gray-400">•</span>
                                                                            <span className="text-gray-600">{expense.paymentMethod}</span>
                                                                        </>
                                                                    )}
                                                                </div>
                                                                <span className="font-semibold text-purple-600 whitespace-nowrap ml-2">${expense.amount.toFixed(2)}</span>
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                            ))}
                                        {Object.keys(getReportData()).length === 0 && (
                                            <p className="text-center text-gray-500 py-4">No expenses found for the selected criteria</p>
                                        )}
                                    </div>
                                </div>
                            )}

                            {/* Expenses List */}
                            <div className="space-y-3">
                                {filteredExpenses.length === 0 ? (
                                    <p className="text-center text-gray-500 py-8">No expenses yet. Add your first expense above!</p>
                                ) : (
                                    filteredExpenses.map(expense => (
                                        <div key={expense.id} className="bg-gray-50 rounded-lg p-4 flex items-center justify-between hover:bg-gray-100 transition">
                                            <div className="flex-1">
                                                <div className="flex items-center gap-2 mb-1">
                                                    <span className="font-semibold text-gray-800">{expense.person}</span>
                                                    <span className="text-sm text-gray-500">• {expense.category}</span>
                                                </div>
                                                <div className="flex flex-wrap items-center gap-2 text-sm text-gray-600">
                                                    <span>{expense.date}</span>
                                                    <span>• {expense.paymentMethod}</span>
                                                </div>
                                            </div>
                                            <div className="flex items-center gap-3">
                                                <span className="text-xl font-bold text-purple-600">${expense.amount.toFixed(2)}</span>
                                                <button
                                                    onClick={() => deleteExpense(expense.id)}
                                                    className="text-red-500 hover:text-red-700 transition text-2xl font-bold"
                                                >
                                                    ×
                                                </button>
                                            </div>
                                        </div>
                                    ))
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('app'));
        root.render(<AliceFamilyExpense />);
    </script>
</body>
</html>
